<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRSnaps - Share Photos via QR Code</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Create Album Page -->
    <div id="create-page" class="container mx-auto px-4 py-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-blue-600">QR Snaps</h1>
            <p class="text-gray-600 mt-2">Create a shared photo album with a QR code</p>
        </header>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-8 max-w-md mx-auto">
            <h2 class="text-2xl font-semibold mb-4">Create New Album</h2>
            <form id="create-album-form">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2" for="album-name">Album Name</label>
                    <input type="text" id="album-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="My Event" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2" for="album-description">Description (optional)</label>
                    <textarea id="album-description" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Add details about your event..."></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Album Duration</label>
                    <select id="album-duration" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="24">24 hours</option>
                        <option value="48">48 hours</option>
                        <option value="72">3 days</option>
                        <option value="168">7 days</option>
                        <option value="2160">3 months</option>
                        <option value="0">No expiration</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition duration-300 font-medium">Generate QR Code</button>
            </form>
        </div>
    </div>

    <!-- QR Code Display Page -->
    <div id="qr-page" class="container mx-auto px-4 py-8 hidden">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold text-blue-600">QRSnaps</h1>
            <p class="text-gray-600 mt-2" id="album-title">Album Created Successfully!</p>
        </header>

        <div class="bg-white rounded-lg shadow-lg p-6 max-w-md mx-auto text-center">
            <h2 class="text-2xl font-semibold mb-2">Share Your QR Code</h2>
            <p class="text-gray-600 mb-6">Friends can scan this code to add up to 5 photos each</p>
            
            <div id="qrcode" class="mx-auto mb-6"></div>
            
            <div id="album-link" class="bg-gray-100 p-3 rounded mb-6 text-sm text-gray-700 break-all"></div>
            
            <div class="flex space-x-3">
                <button id="copy-link" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">Copy Link</button>
                <button id="view-album" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition duration-300">View Album</button>
            </div>
        </div>
    </div>

    <!-- Album View Page -->
    <div id="album-view-page" class="container mx-auto px-4 py-8 hidden">
        <header class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-blue-600" id="view-album-title">Album Name</h1>
                <p class="text-gray-600 mt-1" id="view-album-description">Album description here</p>
            </div>
            <button id="add-photos-btn" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">Add Photos</button>
        </header>

        <div id="no-photos" class="text-center py-12 bg-white rounded-lg shadow-lg">
            <img src="/api/placeholder/200/200" alt="No photos" class="mx-auto mb-4">
            <h2 class="text-2xl font-semibold mb-2">No Photos Yet</h2>
            <p class="text-gray-600 mb-6">Be the first to add photos to this album!</p>
            <button id="start-upload-btn" class="bg-blue-600 text-white py-2 px-8 rounded-md hover:bg-blue-700 transition duration-300">Upload Photos</button>
        </div>

        <div id="photos-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 hidden">
            <!-- Photos will be added here dynamically -->
        </div>
    </div>

    <!-- Photo Upload/Camera Page -->
    <div id="upload-page" class="container mx-auto px-4 py-8 hidden">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-blue-600">Add Photos</h1>
            <p class="text-gray-600 mt-1" id="upload-album-name">Album Name</p>
            <div class="mt-2 bg-blue-100 text-blue-800 px-4 py-2 rounded-lg inline-block">
                <span id="photos-remaining">5</span> photos remaining
            </div>
        </header>

        <div class="bg-white rounded-lg shadow-lg p-6 max-w-md mx-auto mb-8">
            <div class="flex space-x-4 mb-6">
                <button id="take-photo-btn" class="flex-1 bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition duration-300">Take Photo</button>
                <button id="upload-photo-btn" class="flex-1 bg-green-600 text-white py-3 rounded-md hover:bg-green-700 transition duration-300">Upload from Gallery</button>
            </div>

            <input type="file" id="file-input" accept="image/*" multiple class="hidden">
            
            <!-- Camera View -->
            <div id="camera-container" class="hidden mb-4">
                <video id="camera-view" autoplay playsinline class="w-full rounded-lg mb-4"></video>
                <button id="capture-btn" class="w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition duration-300">Capture Photo</button>
                <button id="close-camera-btn" class="w-full mt-2 bg-gray-300 text-gray-800 py-2 rounded-md hover:bg-gray-400 transition duration-300">Cancel</button>
            </div>
            
            <!-- Preview Area -->
            <div id="preview-area" class="hidden">
                <h3 class="text-lg font-semibold mb-3">Selected Photos</h3>
                <div id="photo-previews" class="grid grid-cols-2 gap-4 mb-4">
                    <!-- Photo previews will be added here -->
                </div>
                <button id="upload-selected-btn" class="w-full bg-green-600 text-white py-3 rounded-md hover:bg-green-700 transition duration-300">Upload Selected Photos</button>
                <button id="cancel-upload-btn" class="w-full mt-2 bg-gray-300 text-gray-800 py-2 rounded-md hover:bg-gray-400 transition duration-300">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Upload Success Message -->
    <div id="upload-success" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
        <div class="bg-white rounded-lg p-8 max-w-sm mx-4">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                    <svg class="h-8 w-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">Upload Successful!</h3>
                <p class="text-gray-500 mb-6">Your photos have been added to the album.</p>
                <div class="flex space-x-3">
                    <button id="view-album-btn" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">View Album</button>
                    <button id="add-more-btn" class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 transition duration-300">Add More</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Store data
        const appState = {
            albumId: "",
            albumName: "",
            albumDescription: "",
            albumDuration: 0,
            albumUrl: "",
            uploadedPhotos: [],
            selectedPhotos: [],
            remainingUploads: 5,
            cameraStream: null
        };

        // DOM Elements
        const createPage = document.getElementById('create-page');
        const qrPage = document.getElementById('qr-page');
        const albumViewPage = document.getElementById('album-view-page');
        const uploadPage = document.getElementById('upload-page');
        const uploadSuccess = document.getElementById('upload-success');
        const noPhotos = document.getElementById('no-photos');
        const photosGrid = document.getElementById('photos-grid');
        const previewArea = document.getElementById('preview-area');
        const cameraContainer = document.getElementById('camera-container');

        // Create Album Form
        document.getElementById('create-album-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const albumName = document.getElementById('album-name').value;
            const albumDescription = document.getElementById('album-description').value;
            const albumDuration = document.getElementById('album-duration').value;
            
            // Generate random album ID
            appState.albumId = generateAlbumId();
            appState.albumName = albumName;
            appState.albumDescription = albumDescription;
            appState.albumDuration = albumDuration;
            appState.albumUrl = `${window.location.origin}?album=${appState.albumId}`;
            
            // Show QR code page
            createPage.classList.add('hidden');
            qrPage.classList.remove('hidden');
            
            // Update the album title
            document.getElementById('album-title').textContent = albumName;
            
            // Generate QR Code
            const qrcode = new QRCode(document.getElementById("qrcode"), {
                text: appState.albumUrl,
                width: 200,
                height: 200,
                colorDark: "#3B82F6",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // Show album link
            document.getElementById('album-link').textContent = appState.albumUrl;
        });

        // Copy Link Button
        document.getElementById('copy-link').addEventListener('click', function() {
            navigator.clipboard.writeText(appState.albumUrl)
                .then(() => {
                    this.textContent = "Copied!";
                    setTimeout(() => {
                        this.textContent = "Copy Link";
                    }, 2000);
                });
        });

        // View Album Button
        document.getElementById('view-album').addEventListener('click', function() {
            showAlbumView();
        });

        // Add Photos Button
        document.getElementById('add-photos-btn').addEventListener('click', function() {
            showUploadPage();
        });

        // Start Upload Button (from empty album view)
        document.getElementById('start-upload-btn').addEventListener('click', function() {
            showUploadPage();
        });

        // Take Photo Button
        document.getElementById('take-photo-btn').addEventListener('click', function() {
            startCamera();
        });

        // Upload Photo Button
        document.getElementById('upload-photo-btn').addEventListener('click', function() {
            document.getElementById('file-input').click();
        });

        // File Input Change
        document.getElementById('file-input').addEventListener('change', function(e) {
            handleFileSelect(e.target.files);
        });

        // Capture Button
        document.getElementById('capture-btn').addEventListener('click', function() {
            capturePhoto();
        });

        // Close Camera Button
        document.getElementById('close-camera-btn').addEventListener('click', function() {
            stopCamera();
            cameraContainer.classList.add('hidden');
        });

        // Upload Selected Button
        document.getElementById('upload-selected-btn').addEventListener('click', function() {
            // In a real app, this would upload to a server
            appState.uploadedPhotos = appState.uploadedPhotos.concat(appState.selectedPhotos);
            appState.remainingUploads -= appState.selectedPhotos.length;
            
            // Reset selected photos
            appState.selectedPhotos = [];
            
            // Show success message
            uploadSuccess.classList.remove('hidden');
            previewArea.classList.add('hidden');
        });

        // Cancel Upload Button
        document.getElementById('cancel-upload-btn').addEventListener('click', function() {
            appState.selectedPhotos = [];
            previewArea.classList.add('hidden');
        });

        // View Album Button (after upload)
        document.getElementById('view-album-btn').addEventListener('click', function() {
            uploadSuccess.classList.add('hidden');
            showAlbumView();
        });

        // Add More Button (after upload)
        document.getElementById('add-more-btn').addEventListener('click', function() {
            uploadSuccess.classList.add('hidden');
            if (appState.remainingUploads > 0) {
                updateRemainingCount();
            } else {
                alert("You've reached your upload limit of 5 photos!");
                showAlbumView();
            }
        });

        // Helper Functions
        function generateAlbumId() {
            return Math.random().toString(36).substring(2, 15) + 
                   Math.random().toString(36).substring(2, 15);
        }

        function showAlbumView() {
            qrPage.classList.add('hidden');
            uploadPage.classList.add('hidden');
            albumViewPage.classList.remove('hidden');
            
            // Update album info
            document.getElementById('view-album-title').textContent = appState.albumName;
            document.getElementById('view-album-description').textContent = appState.albumDescription;
            
            // Show photos or empty state
            if (appState.uploadedPhotos.length > 0) {
                noPhotos.classList.add('hidden');
                photosGrid.classList.remove('hidden');
                renderPhotos();
            } else {
                noPhotos.classList.remove('hidden');
                photosGrid.classList.add('hidden');
            }
        }

        function showUploadPage() {
            albumViewPage.classList.add('hidden');
            uploadPage.classList.remove('hidden');
            
            // Update album name
            document.getElementById('upload-album-name').textContent = appState.albumName;
            
            updateRemainingCount();
        }

        function updateRemainingCount() {
            document.getElementById('photos-remaining').textContent = appState.remainingUploads;
        }

        function startCamera() {
            cameraContainer.classList.remove('hidden');
            
            // Access device camera
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    const videoElement = document.getElementById('camera-view');
                    videoElement.srcObject = stream;
                    appState.cameraStream = stream;
                })
                .catch(err => {
                    alert("Error accessing camera: " + err.message);
                    cameraContainer.classList.add('hidden');
                });
        }

        function stopCamera() {
            if (appState.cameraStream) {
                appState.cameraStream.getTracks().forEach(track => track.stop());
                appState.cameraStream = null;
            }
        }

        function capturePhoto() {
            const video = document.getElementById('camera-view');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            // Flip horizontally to fix mirror effect
            ctx.scale(-1, 1);
            ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
            
            const photoData = canvas.toDataURL('image/jpeg');
            
            // Add to selected photos
            if (appState.selectedPhotos.length < appState.remainingUploads) {
                appState.selectedPhotos.push(photoData);
                renderPreview();
                cameraContainer.classList.add('hidden');
                stopCamera();
            } else {
                alert("You've selected the maximum number of photos!");
                stopCamera();
                cameraContainer.classList.add('hidden');
            }
        }

        function handleFileSelect(files) {
            if (files.length > appState.remainingUploads) {
                alert(`You can only upload ${appState.remainingUploads} more photos!`);
                return;
            }
            
            Array.from(files).forEach(file => {
                if (!file.type.match('image.*')) {
                    alert("Only images are allowed!");
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    appState.selectedPhotos.push(e.target.result);
                    if (appState.selectedPhotos.length === files.length) {
                        renderPreview();
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function renderPreview() {
            const container = document.getElementById('photo-previews');
            container.innerHTML = '';
            
            appState.selectedPhotos.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'relative';
                
                const img = document.createElement('img');
                img.src = photo;
                img.className = 'w-full h-40 object-cover rounded-lg';
                div.appendChild(img);
                
                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = '&times;';
                removeBtn.className = 'absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center';
                removeBtn.onclick = () => removeSelectedPhoto(index);
                div.appendChild(removeBtn);
                
                container.appendChild(div);
            });
            
            previewArea.classList.remove('hidden');
        }

        function removeSelectedPhoto(index) {
            appState.selectedPhotos.splice(index, 1);
            renderPreview();
            
            if (appState.selectedPhotos.length === 0) {
                previewArea.classList.add('hidden');
            }
        }

        function renderPhotos() {
            const container = document.getElementById('photos-grid');
            container.innerHTML = '';
            
            appState.uploadedPhotos.forEach(photo => {
                const div = document.createElement('div');
                div.className = 'aspect-w-3 aspect-h-4';
                
                const img = document.createElement('img');
                img.src = photo;
                img.className = 'w-full h-64 object-cover rounded-lg';
                div.appendChild(img);
                
                container.appendChild(div);
            });
        }

        // Check for album ID in URL (for when someone scans QR code)
        function checkUrlForAlbumId() {
            const urlParams = new URLSearchParams(window.location.search);
            const albumId = urlParams.get('album');
            
            if (albumId) {
                // In a real app, this would fetch album details from a server
                // For demo purposes, we'll simulate finding an album
                appState.albumId = albumId;
                appState.albumName = "Demo Album";
                appState.albumDescription = "This is a demo album";
                appState.remainingUploads = 5;
                
                // Go straight to upload page
                createPage.classList.add('hidden');
                showUploadPage();
            }
        }

        // Initialize
        checkUrlForAlbumId();
    </script>

    <style>
        .aspect-w-3 {
            position: relative;
            padding-bottom: 133.33%;
        }
        .aspect-h-4 {
            position: relative;
        }
        .aspect-w-3 > *, .aspect-h-4 > * {
            position: absolute;
            height: 100%;
            width: 100%;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</body>
</html>